---
title: "Predictive Modeling Exercises"
author: "Kessiena Ofunrein, Jordan Pflum, Jennifer Robinson, and Katelyn Vincent"
date: "8/8/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,fig.width=5, fig.height=2)
```
# Question 1
```{r,include=FALSE}

```
# Question 2
The figures below portray a story about the flights arriving in and departing from the Austin Bergstrom International Airport in 2008. We looked at traits of flights and airlines from a few different perspectives to convey an accurate image of what the airport and travelers experienced that year. This analysis of the data is extremely useful for a few different potential clients. Firstly, travelers are the sustenance of this industry and are impacted by the factors we are analyzing. By providing them with some of these graphs, travelers will be more informed about some things they are likely to experience temporally, geographically, or with a specific airline. Secondly, airport officials would benefit greatly from our analysis because it is advantageous to know what one is likely to experience with each airport. Airports are businesses with reputations and standards. Notoriety for delayed flights is very useful information for preparations and strategic planning. 
```{r,include=FALSE}
library(magrittr)
library(ggplot2)
library(ggmosaic)
library(varhandle)
library(lubridate)
library(dplyr)
###############################################################################
#set up the data frame and graphs
#FILES NEEDED IN FOLDER:
    #ABIA.csv
    #airline_codes.csv
###############################################################################3
# add column for airline
airport <- read.csv("ABIA.csv",header=T, na.strings=c("",NA))
airlinecodes <- read.csv("airline_codes.csv")
abia <- airport %>% left_join(airlinecodes,by="UniqueCarrier")

# replace n/a cells with zero
abia[is.na(abia)] <- 0
abia[abia=='NULL'] <- 0

# recode cancellation code
abia$CancellationCode <- recode(abia$CancellationCode, 
                                "A"="Carrier",
                                "B"="Weather",
                                "C"="NAS")

abia$CancellationCode <- factor(abia$CancellationCode, 
                                levels= c("Carrier",
                                          "Weather",
                                          "NAS"))

# recode days of week
abia$DayOfWeek <- recode(abia$DayOfWeek, 
                         "7"="Sunday",
                         "1"="Monday",
                         "2"="Tuesday",
                         "3"="Wednesday",
                         "4"="Thursday",
                         "5"="Friday",
                         "6"="Saturday")

abia$DayOfWeek <- factor(abia$DayOfWeek, 
                         levels= c("Monday", 
                                   "Tuesday",
                                   "Wednesday", 
                                   "Thursday",
                                   "Friday", 
                                   "Saturday", 
                                   "Sunday"))

# recode months
abia$MonthName <- recode(abia$Month, 
                         "1"="Jan",
                         "2"="Feb",
                         "3"="Mar",
                         "4"="April",
                         "5"="May",
                         "6"="June",
                         "7"="July",
                         "8"="Aug",
                         "9"="Sept",
                         "10"="Oct",
                         "11"="Nov",
                         "12"="Dec")

abia$MonthName <- factor(abia$MonthName, 
                         levels= c("Jan",
                                   "Feb",
                                   "Mar",
                                   "April",
                                   "May",
                                   "June",
                                   "July",
                                   "Aug",
                                   "Sept",
                                   "Oct",
                                   "Nov",
                                   "Dec"))

# create date column
abia$date <- as.Date(with(abia, paste(Year, Month, DayofMonth,sep="-")), "%Y-%m-%d")
abia$weeknum <- isoweek(abia$date)

# set colorblind-friendly palette
cbPalette <- c("#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
###############################################################################
#SUBSET                   most popular airlines (above mean)
commonair <- data.frame(count(abia, vars = Airline)) #df of airlines and frequency in abia data frame
airline.counts <- table(abia$Airline) #table of counts similar to commonair
barplot(airline.counts, main="Frequency of Airlines",
        xlab="Airline")

airline.mean <- mean(commonair$n) #mean frequency of airlines in abia
x.sub <- commonair %>%
  filter(n >= airline.mean) #data frame of list of airlines who's frequency is > median
airlines <- x.sub$vars #list of popular airlines

popular.abia <- subset(abia, Airline %in% airlines) #data frame with info for each flight for popular airlines
###############################################################################
#SUBSET                   FILTER OUT SHORT DELAYS AND MOST POPULAR AIRLINES AIRLINES~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~``
summary(popular.abia$ArrDelay)
m<- mean(popular.abia$ArrDelay, na.rm=TRUE) #exclude NA from calculations 
longARRdelays <-popular.abia %>% filter(ArrDelay > m)

summary(abia$DepDelay)
n<- mean(popular.abia$DepDelay, na.rm=TRUE) #exclude NA from calculations 
longDEPdelays <-popular.abia %>% filter(DepDelay > n)
```
The line graph figures below are a time series analysis of how the length of flight delays changes throughout the year 2018. The graphs are relatively similar and have peaks during similar times. They are separated by arriving and departing flights, essentially whether the plane was late coming in or late coming out. It is to be expected that a change in one would impact an airportâ€™s schedule thus resulting in changes in the other. For both graphs there are peaks in months like March, June, and December. It is easy to deduce the cause of that could be holidays or related to school schedules like Spring Break. For a more concrete picture further analysis should be conducted. The airlines graphed here have more flights than the average airline and the delays are considered long delays because they are in the 75th percentile. 
```{r, echo=FALSE} 
##############################    LINE GRAPHS   ##############################

#LINE PLOT MONTH VS AVERAGE ARRIVAL DELAY TIME BY AIRLINE FOR POPULAR AIRLINES -----------------------------DONE 
AvgArrDelay <- longARRdelays %>%
  group_by(Month, Airline) %>%
  summarize(avgArrDelay = mean(ArrDelay, na.rm = TRUE))
ggplot(AvgArrDelay, aes(x=Month, y=avgArrDelay, group=Airline))+ 
  scale_fill_brewer(palette="Paired") +
  geom_line(aes(color=Airline))+
  geom_point(aes(color=Airline))+ 
  ggtitle("Average Arrival Delay Over Time (Year:2018)") +
  xlab("Airline") + 
  ylab("Average Arrival Delay")
#---------------------------------------------------------------------------------------END

#LINE PLOT MONTH VS AVERAGE DEPARTURE DELAY TIME BY AIRLINE FOR POPULAR AIRLINES -----------------------------DONE 
AvgDepDelay <- longARRdelays %>%
  group_by(Month, Airline) %>%
  summarize(avgDepDelay = mean(DepDelay, na.rm = TRUE))
ggplot(AvgDepDelay, aes(x=Month, y=avgDepDelay, group=Airline))+ 
  scale_fill_brewer(palette="Paired") +
  geom_line(aes(color=Airline))+
  geom_point(aes(color=Airline))+ 
  ggtitle("Average Departure Delay Over Time (Year:2018)") +
  xlab("Airline") + 
  ylab("Average Departure Delay")
#---------------------------------------------------------------------------------------END
```
As we transition our focus from how flights are delayed for longer periods of time seasonally, we can also look at the different types of cancellations and delays. The graph below enables us to compare three types of cancellation codes: Carrier, Weather, and NAS. This plot is clearly able to show that NAS delays do not account for many delays and truly do not compare to weather or carrier delays. 

```{r, echo=FALSE}
# aggregate the data set by more than one factor
d2 = abia  %>% filter(abia$CancellationCode != 0) %>%
  group_by(CancellationCode, DayOfWeek) %>%
  summarize(numcancels=n()/52)

# plot
ggplot(data = d2) + 
  geom_bar(mapping = aes(x=DayOfWeek, y=numcancels, fill=CancellationCode),
           position="dodge", stat='identity') +
  labs(x = "Weekday", fill = "Cancellation Code") +
  scale_fill_manual(values=cbPalette) +
  theme_bw() +
  ggtitle("Average Number of Cancelled Flights by Weekday in 2008") +
  # center plot title
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(x = "Weekday",y = "Avg # Cancelled Flights")
```
In the graph below, we look at a similar trend but over months so we can look at a seasonal picture of the flights. Some interesting anomalies are found in April and September. Based on knowledge of seasonal changes in weather, one could conclude that the significant flux in weather delays in September could be explained by hurricane season. As for April, carrier delays could increased significantly by **_______________**. 
```{r,echo=FALSE}
# aggregate the data set by more than one factor
d12 = abia %>% filter(abia$CancellationCode != 0) %>%
  group_by(CancellationCode, MonthName) %>%
  summarize(numcancelled=n())

d13 = abia %>%
  group_by(MonthName) %>%
  summarize(numflights=n(),.groups = 'drop') %>%
  ungroup() %>%
  arrange(desc(numflights))

combo4 <-merge(x=d12,y=d13,by="MonthName",all.x=TRUE)
combo4$cancperc <- combo4$numcancelled/combo4$numflights
combo4$numcancelled <- NULL
combo4$numflights <- NULL

# plot
ggplot(data = combo4) + 
  geom_bar(mapping = aes(x=MonthName, y=cancperc, fill=CancellationCode),
           position="dodge", stat='identity') +
  labs(x = "Month", fill = "Cancellation Code") +
  scale_fill_manual(values=cbPalette) +
  theme_bw() +
  ggtitle("Percent of Flights Cancelled by Month in 2008") +
  # center plot title
  theme(plot.title = element_text(hjust = 0.5))+
  # add labels
  labs(x = "2008",y = "% Flights Cancelled")

```
Strategic planning is a fundamental component of how airports sustain themselves. Knowing that an airport or region is notorious for delays or that they are notorious for this seasonally, plans can be made to accommodate to yield the best options for travelers. A simple way to summarize this information in a plot is through geographical mapping. Figure ___ shows this. An airport official should be concerned about a large dot that is lightly shaded, as this airport has a lot of flights outgoing to the Austin airport and are often delayed.
```{r}
##############################    GEO PLOT   ##############################

```
# Question 3
```{r}

```
# Question 4
```{r}

```
# Question 5
```{r}

```
# Question 6
```{r}

```




